<div class="details-panel">
  <div ng-if="state.loading" class="header">
    <div class="close-button">
      <a class="btn btn-link" ui-sref="^">
        <span class="glyphicon glyphicon-remove"></span>
      </a>
    </div>
    <div class="horizontal center middle">
      <loading-spinner size="'small'"></loading-spinner>
    </div>
  </div>

  <div ng-if="!state.loading" class="header">
    <div class="close-button">
      <a class="btn btn-link" ui-sref="^">
        <span class="glyphicon glyphicon-remove"></span>
      </a>
    </div>
    <div class="header-text horizontal middle">
      <i class="fa icon-sitemap"></i>
      <h3 class="horizontal middle space-between flex-1" select-on-dbl-click>{{loadBalancer.name}}</h3>
    </div>
    <div>
      <div class="actions">
        <div class="dropdown" uib-dropdown dropdown-append-to-body>
          <button type="button" class="btn btn-sm btn-primary dropdown-toggle" uib-dropdown-toggle>
            Load Balancer Actions <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" uib-dropdown-menu role="menu">
            <li><a href ng-click="ctrl.editLoadBalancer()">Edit Load Balancer</a></li>
            <li ng-if="!loadBalancer.serverGroups.length">
              <a href ng-click="ctrl.deleteLoadBalancer()">Delete Load Balancer</a>
            </li>
            <li
              ng-if="loadBalancer.serverGroups.length"
              class="disabled"
              tooltip="You must detach all server groups before you can delete this load balancer."
            >
              <a href ng-click="ctrl.deleteLoadBalancer()">Delete Load Balancer</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div ng-if="!state.loading" class="content">
    <collapsible-section ng-if="showInClb" heading="Load Balancer Details" expanded="true">
      <hello-world load-balancer="loadBalancer.elb.results" app="app"></hello-world>
      <dl class="dl-horizontal dl-flex">
        <dt>Created</dt>
        <dd>{{loadBalancer.elb.results.createTimeStamp | date:'yyyy-MM-dd HH:mm:ss'}}</dd>
        <dt>LoadBalancerType</dt>
        <dd>{{loadBalancer.elb.results.loadBalancerType}}</dd>
        <dt>In</dt>
        <dd>
          <account-tag account="loadBalancer.account" pad="right" provider="loadBalancer.type"></account-tag>
          {{loadBalancer.region}}
        </dd>
        <dt ng-if="loadBalancer.elb.results.attributes.addressType!='internet'">VPC</dt>
        <dd ng-if="loadBalancer.elb.results.attributes.addressType!='internet'">{{loadBalancer.elb.results.vpcId}}</dd>
        <dt ng-if="loadBalancer.elb.results.attributes.addressType!='internet'">Subnet</dt>
        <dd ng-if="loadBalancer.elb.results.attributes.addressType!='internet'">
          {{loadBalancer.elb.results.vswitchId}}
        </dd>
      </dl>
      <dl>
        <dt>Address</dt>
        <dd>{{loadBalancer.elb.results.attributes.address}}</dd>
        <dt>AddressIPVersion</dt>
        <dd>{{loadBalancer.elb.results.attributes.addressIPVersion}}</dd>
        <dt>AddressType</dt>
        <dd>{{loadBalancer.elb.results.attributes.addressType}}</dd>
        <dt>LoadBalancerSpec</dt>
        <dd>{{loadBalancer.elb.results.attributes.loadBalancerSpec}}</dd>
      </dl>
      <dl class="horizontal-when-filters-collapsed">
        <dt ng-if="loadBalancer.serverGroups">Server Groups</dt>
        <dd ng-if="loadBalancer.serverGroups">
          <ul class="collapse-margin-on-filter-collapse">
            <li ng-repeat="serverGroup in loadBalancer.serverGroups | orderBy: ['isDisabled', '-name']">
              <a
                ui-sref="^.serverGroup({region: serverGroup.region,
                                          accountId: serverGroup.account,
                                          serverGroup: serverGroup.name,
                                          provider: 'alicloud'})"
              >
                {{serverGroup.name}}
              </a>
            </li>
          </ul>
        </dd>
      </dl>
    </collapsible-section>
    <collapsible-section ng-if="showInClb" heading="Listeners">
      <dl
        ng-repeat="loadBalancingRule in loadBalancer.elb.results.attributes.listenerPortsAndProtocal"
        style="border-bottom: 1px solid #eee; padding-bottom: 20px"
      >
        <dt>Load Balancer &rarr; Instance</dt>
        <dd>
          {{loadBalancingRule.listenerProtocol}}:{{loadBalancingRule.listenerPort}} &rarr;
          {{loadBalancingRule.backendServerPort}}
        </dd>
        <dt>Target</dt>
        <dd>{{loadBalancingRule.listenerProtocol}}</dd>
        <dt>Interval</dt>
        <dd>{{loadBalancingRule.healthCheckInterval}} seconds</dd>
        <dt>Unhealthy Threshold</dt>
        <dd>{{loadBalancingRule.unhealthyThreshold}}</dd>
        <dt>Timeout</dt>
        <dd>{{loadBalancingRule.healthCheckTimeout}} seconds</dd>
        <dt ng-show="loadBalancingRule.cookie== null || !loadBalancingRule.cookie">Cookie</dt>
        <dd ng-show="loadBalancingRule.cookie== null || !loadBalancingRule.cookie">{{loadBalancingRule.cookie}}</dd>
        <dt ng-show="loadBalancingRule.cookieTimeout== null || !loadBalancingRule.cookieTimeout">CookieTimeout</dt>
        <dd ng-show="loadBalancingRule.cookieTimeout== null || !loadBalancingRule.cookieTimeout">
          {{loadBalancingRule.cookieTimeout}} seconds
        </dd>
        <dt ng-show="loadBalancingRule.gzip== null || !loadBalancingRule.gzip">Gzip</dt>
        <dd ng-show="loadBalancingRule.gzip== null || !loadBalancingRule.gzip">{{loadBalancingRule.gzip}}</dd>
        <dt>HealthCheckHttpCode</dt>
        <dd>{{loadBalancingRule.healthCheckHttpCode}}</dd>
        <dt>IdleTimeout</dt>
        <dd>{{loadBalancingRule.idleTimeout}} seconds</dd>
        <dt ng-show="loadBalancingRule.stickySessionType== null || !loadBalancingRule.stickySessionType">
          StickySessionType
        </dt>
        <dd ng-show="loadBalancingRule.stickySessionType== null || !loadBalancingRule.stickySessionType">
          {{loadBalancingRule.stickySessionType}}
        </dd>
        <dt ng-show="loadBalancingRule.requestTimeout== null || !loadBalancingRule.requestTimeout">RequestTimeout</dt>
        <dd ng-show="loadBalancingRule.requestTimeout== null || !loadBalancingRule.requestTimeout">
          {{loadBalancingRule.requestTimeout}} seconds
        </dd>
        <dt>Scheduler</dt>
        <dd>{{loadBalancingRule.scheduler}}</dd>
      </dl>
    </collapsible-section>

    <collapsible-section ng-if="showInAlb" heading="Load Balancer Details" expanded="true">
      <!-- <hello-world load-balancer="loadBalancer.elb.results" test="233"></hello-world> -->
      <dl class="dl-horizontal dl-flex">
        <dt>Created</dt>
        <dd>{{loadBalancer.elb.results.createTime | date:'yyyy-MM-dd HH:mm:ss'}}</dd>
        <dt>LoadBalancerType</dt>
        <dd>{{loadBalancer.elb.results.loadBalancerType}}</dd>
        <dt>In</dt>
        <dd>
          <account-tag account="loadBalancer.account" pad="right" provider="loadBalancer.type"></account-tag>
          {{loadBalancer.region}}
        </dd>
        <dt>VPC</dt>
        <dd>{{loadBalancer.elb.results.vpcId}}</dd>
        <dt>Subnet</dt>
        <dd>
          <li ng-repeat="subnet in subnets" style="list-style-type: none">{{subnet}}</li>
        </dd>
      </dl>
      <dl class="dl-horizontal dl-flex">
        <dt>AddressModel</dt>
        <dd>{{loadBalancer.elb.results.addressAllocatedMode}}</dd>
        <dt>AddressType</dt>
        <dd>{{loadBalancer.elb.results.addressType}}</dd>
      </dl>
    </collapsible-section>

    <collapsible-section ng-if="showInAlb" heading="TargetServerGroups">
      <dl
        ng-repeat="targetGroup in loadBalancer.elb.results.targetServerGroups"
        style="border-bottom: 1px solid #eee; padding-bottom: 20px"
      >
        <dt>account</dt>
        <dd>{{targetGroup.attributes.account}}</dd>
        <dt>protocol</dt>
        <dd>{{targetGroup.attributes.bizProtocol}}</dd>
        <dt>region</dt>
        <dd>{{targetGroup.attributes.region}}</dd>
        <dt>resourceGroupId</dt>
        <dd>{{targetGroup.attributes.resourceGroupId}}</dd>
        <dt>scheduler</dt>
        <dd>{{targetGroup.attributes.scheduler}}</dd>
        <dt>serverCount</dt>
        <dd>{{targetGroup.attributes.serverCount}}</dd>
        <dt>serverGroupId</dt>
        <dd>{{targetGroup.attributes.serverGroupId}}</dd>
        <dt>serverGroupName</dt>
        <dd>{{targetGroup.attributes.serverGroupName}}</dd>
        <dt>serverGroupStatus</dt>
        <dd>{{targetGroup.attributes.serverGroupStatus}}</dd>
        <dt>serverGroupType</dt>
        <dd>{{targetGroup.attributes.serverGroupType}}</dd>
        <dt>vpcId</dt>
        <dd>{{targetGroup.attributes.vpcId}}</dd>
        <dt>healthCheckEnabled</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthCheckEnabled.toString()}}</dd>
        <dt>healthCheckConnectPort</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthCheckConnectPort}}</dd>
        <dt>healthCheckHost</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthCheckHost}}</dd>
        <dt>healthCheckHttpVersion</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthCheckHttpVersion}}</dd>
        <dt>healthCheckInterval</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthCheckInterval}}</dd>
        <dt>healthCheckMethod</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthCheckMethod}}</dd>
        <dt>healthCheckProtocol</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthCheckProtocol}}</dd>
        <dt>healthCheckTimeout</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthCheckTimeout}}</dd>
        <dt>healthyThreshold</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.healthyThreshold}}</dd>
        <dt>unhealthyThreshold</dt>
        <dd>{{targetGroup.attributes.healthCheckConfig.unhealthyThreshold}}</dd>
        <dt>stickySessionEnabled</dt>
        <dd>{{targetGroup.attributes.stickySessionConfig.stickySessionEnabled.toString()}}</dd>
        <dt>stickySessionType</dt>
        <dd>{{targetGroup.attributes.stickySessionConfig.stickySessionType}}</dd>
        <dt>cookieTimeout</dt>
        <dd>{{targetGroup.attributes.stickySessionConfig.cookieTimeout}}</dd>
      </dl>
    </collapsible-section>

    <collapsible-section ng-if="showInAlb" heading="Listeners">
      <!-- <load-balancer-alb-listeners
      listeners="loadBalancer.elb.results.listeners"
      > </ad-balancer-alb-listeners> -->
      <dl
        ng-repeat="listener in loadBalancer.elb.results.listeners"
        style="border-bottom: 1px solid #eee; padding-bottom: 20px"
      >
        <dt>listenerId</dt>
        <dd>{{listener.listenerId}}</dd>
        <dt>listenerPort</dt>
        <dd>{{listener.listenerPort}}</dd>
        <dt>listenerProtocol</dt>
        <dd>{{listener.listenerProtocol}}</dd>
        <dt>listenerStatus</dt>
        <dd>{{listener.listenerStatus}}</dd>
        <dt>loadBalancerId</dt>
        <dd>{{listener.loadBalancerId}}</dd>
        <dt>loadBalancerName</dt>
        <dd>{{listener.loadBalancerName}}</dd>
        <dt>requestTimeout</dt>
        <dd>{{listener.requestTimeout}}</dd>
        <dt>gzipEnabled</dt>
        <dd>{{listener.gzipEnabled.toString()}}</dd>
        <dt>idleTimeout</dt>
        <dd>{{listener.idleTimeout}}</dd>
        <dt ng-if="listener.rules.length !== 0">rules</dt>
        <dd>
          <dl
            ng-repeat="rule in listener.rules"
            style="border-bottom: 1px solid #eee; padding-bottom: 20px; border: none; padding: 0"
          >
            <dt>ruleId</dt>
            <dd>{{rule.ruleId}}</dd>
            <dt>ruleName</dt>
            <dd>{{rule.ruleName}}</dd>
            <dt>ruleStatus</dt>
            <dd>{{rule.ruleStatus}}</dd>
            <dt>conditions</dt>
            <dd>
              <dl
                ng-repeat="condition in rule.conditions"
                style="border-bottom: 1px solid #eee; padding-bottom: 20px; border: none; padding: 0"
              >
                <dt>condition type</dt>
                <dd>{{condition.type}}</dd>
                <dt>{{condition.type}} values</dt>
                <dd><li ng-repeat="value in condition.values" style="list-style-type: none">{{value}}</li></dd>
              </dl>
            </dd>
            <dt>actions</dt>
            <dd>
              <dl
                ng-repeat="action in rule.actions"
                style="border-bottom: 1px solid #eee; padding-bottom: 20px; border: none; padding: 0"
              >
                <dt>action type</dt>
                <dd>{{action.type}}</dd>
                <dt ng-if="action.type == 'ForwardGroup'">forwardGroupConfig</dt>
                <dd>
                  <li
                    ng-repeat="serverGroup in action.forwardGroupConfig.serverGroupTuples"
                    style="list-style-type: none"
                  >
                    {{serverGroup.serverGroupName}}
                  </li>
                </dd>
                <dt ng-if="action.type == 'Redirect'">redirectConfig</dt>
                <dd>
                  <p>{{action.redirectConfig.protocol}}</p>
                  <p>{{action.redirectConfig.port}}</p>
                  <p>{{action.redirectConfig.path}}</p>
                  <p>{{action.redirectConfig.query}}</p>
                  <p>{{action.redirectConfig.httpCode}}</p>
                </dd>
              </dl>
            </dd>
          </dl>
        </dd>
      </dl>
    </collapsible-section>
  </div>
</div>
